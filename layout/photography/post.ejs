<% const m = moment(page.date) -%>
<main class="photography-series series">
  <header class="series-header">
    <h1 class="series__headline"><%= page.title %></h1>

    <div class="series__summary"><%- page.excerpt || page.content %></div>

    <ul class="series-header__metadata">
      <li class="metadata metadata--date">
        <time datetime="<%= m.toISOString() %>"><%= m.format('YYYY') %></time>
      </li>
      <li class="metadata"><%= page.pictures.length %> pictures</li>
      <li class="metadata"><%= page.device.manufacturer %> <%= page.device.model %></li>
      <% if (page.film) { const { film } = page; -%>
      <li class="metadata"><%= film.manufacturer %> <%= film.model %> (<%= film.speed %>ISO)</li>
      <% } %>
    </ul>
  </header>

  <% page.pictures.forEach(p => { -%>
  <article class="series-item">

    <figure class="series-item__enclosure">
      <div class="series-item__media">
        <img src="<%= img_url(p.src.img || p.src, page)%>" alt="" class="series-item__picture" data-lazyload>
      </div>

      <figcaption class="series-item__caption">
        <% if (p.comment) { %>
        <div class="series-item__comment"><%- markdown(p.comment) %></div>
        <% } -%>
        <% if (p.date) { const m = moment(p.date) -%>
        <date time="<%= m.toISOString() %>" class="series-item__date">
          <%= m.format('MMMM Do YYYY') %>
        </date>
        <% } -%>
        <% if (p.location){ -%>
        <address class="series-item__address">
          <% ['venue', 'region', 'country'].filter(d => p.location[d]).forEach(d => { -%>
          <span class="series-item__<%= d %>"><%= p.location[d] %></span>
          <% }) -%>
        </address>
        <% } %>
      </figcaption>
    </figure>
  </article>
  <% }) %>
</main>
